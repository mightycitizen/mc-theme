{#graphql
fragment MenuItem on MenuItem {
  text:title
  url
  internal
  children {
    text:title
    url
    internal
  }
  extras {
    ... on MenuLinkContentMain {
      icon
    }
    ... on MenuLinkContentMainCtum {
      icon
    }
    ... on MenuLinkContentMainUtility {
      icon
    }
  }
}

query Header {
  main: menu(name: MAIN) {
    items {
      ...MenuItem
    }
  }
  main_utility: menu(name: MAIN_UTILITY) {
    items {
      ...MenuItem
    }
  }
  main_cta: menu(name: MAIN_CTA) {
    items {
      ...MenuItem
    }
  }
}
#}

{% set menu_data = [] %}

{#
  Loop through menu items and add to new array, with a slightly different structure
  Formats icon for front end integration and moves it to the same level as other link data.
#}
{% for menu_name in ['main', 'main_utility', 'main_cta'] %}
  {# New array for current menu #}
  {% set current_menu = [] %}

  {% set items = graphql[menu_name].items %}

  {# Top level nav items with children #}
  {% for item in items %}
    {% set item = item|merge({
      icon: item.extras.icon ? mc_icon(item.extras.icon) : NULL,
    }) %}

    {# Add nav items to current menu #}
    {% set current_menu = current_menu|merge([item]) %}
  {% endfor %}

  {# Add current menu to larger menu array #}
  {% set menu_data = menu_data|merge({
    (menu_name): current_menu
  }) %}
{% endfor %}

{# Pass updated menu data to SDC. #}
{{ include('mc_theme:header', {
  menu: menu_data.main,
  utility_menu: menu_data.main_utility,
  cta_menu: menu_data.main_cta,
}) }}
